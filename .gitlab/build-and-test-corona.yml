################################################################################
## Copyright 2019-2023 Lawrence Livermore National Security, LLC and other
## DiHydrogen Project Developers. See the top-level LICENSE file for details.
##
## SPDX-License-Identifier: Apache-2.0
################################################################################

stages:
  - build

include:
  local: "/.gitlab/build-and-test-common.yml"

# Note: We load gcc/10.3.1-magic to get the right MPI but it's not
# (directly) used.
rocm-5-4-3:
  variables:
    SPEC: "%rocmcc@5.4.3 +developer +rocm amdgpu_target=gfx906 ^hip@5.4.3 ^llvm-amdgpu@5.4.3 ^hsa-rocr-dev@5.4.3"
    MODULES: "gcc/10.3.1-magic openmpi/4.1.2 rocm/5.4.3 ninja/1.11.0"
  extends: .build-and-test-on-corona

rocm-5-5-0:
  variables:
    SPEC: "%rocmcc@5.5.0 +developer +rocm amdgpu_target=gfx906 ^hip@5.5.0 ^llvm-amdgpu@5.5.0 ^hsa-rocr-dev@5.5.0"
    MODULES: "gcc/10.3.1-magic openmpi/4.1.2 rocm/5.5.0 ninja/1.11.0"
  extends: .build-and-test-on-corona

.build-and-test-on-corona:
  stage: build
  variables:
    LLNL_SLURM_SCHEDULER_PARAMETERS: "-N1 -t 10"
    LLNL_FLUX_SCHEDULER_PARAMETERS: "-N1 -t 10"
  tags: [corona, batch]
  extends: .build-and-test
