##############################################################################
# Copyright (c) 2023, Lawrence Livermore National Security, LLC and RADIUSS
# project contributors. See the COPYRIGHT file for details.
#
# SPDX-License-Identifier: (MIT)
##############################################################################

# With GitLab CI, included files cannot be empty.
variables:
  INCLUDED_FILE_CANNOT_BE_EMPTY: "True"

## Template for extra jobs defined by the project.
#<job-name (usually spec or description)>:
#  variables:
#    SPEC: "<spack spec without package name>"
#  extends: .build_and_test_on_pascal

gcc_10_3_1:
  variables:
    ON_PASCAL: "ON"
#    GCOVR: "/usr/workspace/brain/katie/h2_ci_env_pascal/bin/gcovr"
#    GCOV: "/opt/rh/gcc-toolset-10/root/usr/bin/gcov"
    BUILD_DIR: "build_dihydrogen-linux-rhel8-zen2-rocmcc@5.4.3"
#  after_script:
#    - find -name '*.gcno' -exec ${GCOV} -b -c -f -r -s
#      ${CI_PROJECT_DIR} {} \;
#    - ${GCOVR} -g -k --cobertura-pretty --exclude-unreachable-branches --print-summary
#      -o corona-coverage.xml
#  coverage: /^\s*lines:\s*\d+.\d+\%/
  artifacts:
    when: always
    paths:
      - ${CI_PROJECT_DIR}/*.xml
      - ${CI_PROJECT_DIR}/*.cmake
      - ${CI_PROJECT_DIR}/${BUILD_DIR}/Testing/Temporary/*.log
    name: ${CI_JOB_NAME}-${CI_COMMIT_REF_NAME}-${CI_COMMIT_SHA}
    expire_in: 2 days
    reports:
      junit: ${CI_PROJECT_DIR}/*_junit.xml
#      coverage_report:
#        coverage_format: cobertura
#        path: ${CI_PROJECT_DIR}/corona-coverage.xml
  extends: .build_and_test_on_pascal

gcc_10_3_1_cuda_11_8_0:
  variables:
    ON_PASCAL: "ON"
#    GCOVR: "/usr/workspace/brain/katie/h2_ci_env_pascal/bin/gcovr"
#    GCOV: "/opt/rh/gcc-toolset-10/root/usr/bin/gcov"
    BUILD_DIR: "build_dihydrogen-linux-rhel8-zen2-rocmcc@5.4.3"
#  after_script:
#    - find -name '*.gcno' -exec ${GCOV} -b -c -f -r -s
#      ${CI_PROJECT_DIR} {} \;
#    - ${GCOVR} -g -k --cobertura-pretty --exclude-unreachable-branches --print-summary
#      -o corona-coverage.xml
#  coverage: /^\s*lines:\s*\d+.\d+\%/
  artifacts:
    when: always
    paths:
      - ${CI_PROJECT_DIR}/*.xml
      - ${CI_PROJECT_DIR}/*.cmake
      - ${CI_PROJECT_DIR}/${BUILD_DIR}/Testing/Temporary/*.log
    name: ${CI_JOB_NAME}-${CI_COMMIT_REF_NAME}-${CI_COMMIT_SHA}
    expire_in: 2 days
    reports:
      junit: ${CI_PROJECT_DIR}/*_junit.xml
#      coverage_report:
#        coverage_format: cobertura
#        path: ${CI_PROJECT_DIR}/corona-coverage.xml
  extends: .build_and_test_on_pascal

gcc_10_3_1_distconv:
  variables:
    ON_PASCAL: "ON"
#    GCOVR: "/usr/workspace/brain/katie/h2_ci_env_pascal/bin/gcovr"
#    GCOV: "/opt/rh/gcc-toolset-10/root/usr/bin/gcov"
    BUILD_DIR: "build_dihydrogen-linux-rhel8-zen2-rocmcc@5.4.3"
    SPEC: "${PROJECT_PASCAL_VARIANTS} +distconv +al %gcc@10.3.1 ${PROJECT_PASCAL_DEPS}"
#  after_script:
#    - find -name '*.gcno' -exec ${GCOV} -b -c -f -r -s
#      ${CI_PROJECT_DIR} {} \;
#    - ${GCOVR} -g -k --cobertura-pretty --exclude-unreachable-branches --print-summary
#      -o corona-coverage.xml
#  coverage: /^\s*lines:\s*\d+.\d+\%/
  artifacts:
    when: always
    paths:
      - ${CI_PROJECT_DIR}/*.xml
      - ${CI_PROJECT_DIR}/*.cmake
      - ${CI_PROJECT_DIR}/${BUILD_DIR}/Testing/Temporary/*.log
    name: ${CI_JOB_NAME}-${CI_COMMIT_REF_NAME}-${CI_COMMIT_SHA}
    expire_in: 2 days
    reports:
      junit: ${CI_PROJECT_DIR}/*_junit.xml
#      coverage_report:
#        coverage_format: cobertura
#        path: ${CI_PROJECT_DIR}/corona-coverage.xml
  extends: .build_and_test_on_pascal

# Disabled tests